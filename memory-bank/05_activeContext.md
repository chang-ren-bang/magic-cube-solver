# 5. 當前背景 (Active Context)

## 當前工作焦點

*   **實作旋轉動畫**: 使用 Three.js 和 Tween.js 實現魔術方塊的單步旋轉動畫。

## 近期變更

*   **引入 Tween.js**: 在 `index.html` 中加入 Tween.js 的 CDN 連結。
*   **實作旋轉動畫 (`js/CubeRenderer.js`)**:
    *   加入 `isAnimating` 狀態旗標。
    *   在 `animate` 循環中加入 `TWEEN.update()`。
    *   實作 `animateRotation(move, duration)` 方法，使用 Tween.js 動畫臨時 pivot 群組的旋轉，並在完成後將方塊移回主場景。
*   **連接打亂動畫 (`main.js`)**:
    *   修改 `randomizeBtn` 事件監聽器為 `async`。
    *   在動畫期間禁用按鈕。
    *   迭代打亂序列，`await` 每個 `renderer.animateRotation()` 呼叫。
    *   在每個視覺動畫完成後，才更新 `CubeState`。
*   (先前變更) 渲染引擎遷移至 Three.js。
*   (先前變更) 建立了 `js/CubeState.js` 模組。
*   (先前變更) 採用反轉打亂序列作為簡易 "解題" 方法 (`js/SimpleSolver.js`)。

## 下一步計畫

1.  **連接解題動畫**: 修改 `solveBtn` 的事件監聽器，使其也能一步步播放 `SimpleSolver.js` 返回的反轉序列動畫。
2.  **動畫微調與測試**: 測試旋轉動畫的穩定性和視覺效果，修復潛在問題（例如物件跳躍）。
3.  **UI/UX 優化**: 禁用按鈕、顯示當前動畫步驟等。
4.  **(可選) 替換為真實解題器**: 未來如果需要，可以重新評估並實作或整合一個真正的解題演算法來取代目前的反轉邏輯。

## 當前決策與考量

*   **檔案結構**: 採用簡單的根目錄結構 (`index.html`, `style.css`, `main.js`)，並將 Memory Bank 放在 `memory-bank/` 子目錄中。未來可能根據複雜度增加而建立 `src/` 或 `js/` 等子目錄。
*   **渲染技術**: **已從 Canvas 2D 切換到 Three.js (WebGL)**。
*   **動畫技術**: **引入 Tween.js** 輔助實現平滑動畫。
*   **檔案結構**: 保持簡單的根目錄結構。

## 重要模式與偏好

*   **渲染**: **擁抱 Three.js** 以獲得更好的 3D 效果和開發效率。
*   **動畫**: **利用 Tween.js** 簡化動畫插值計算。
*   **模組化**: 儘早開始將程式碼組織成模組 (ES6 Modules)。 (持續進行中)
*   **註解與可讀性**: 保持程式碼清晰、易於理解，特別是涉及 Three.js API、狀態管理和**動畫邏輯**的部分。

## 學習與洞見

*   整合外部函式庫（特別是透過 CDN）可能存在版本、路徑或可用性問題。
*   自行實作核心功能（如解題器）雖然挑戰更大，但能提供更多控制權並避免外部依賴問題。（目前採用反轉序列作為權宜之計）
*   使用成熟的 3D 函式庫 (Three.js) 可以顯著簡化渲染部分的開發，但需要投入時間學習其 API。
*   Three.js 中的物件父子關係和世界變換更新（尤其是在 attach/detach 操作後）是實現正確動畫的關鍵點。
