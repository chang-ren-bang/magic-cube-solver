# 5. 當前背景 (Active Context)

## 當前工作焦點

*   **專案初始化**: 建立基本的專案結構和 Memory Bank 文件。
*   **基礎 HTML/CSS**: 設定主要的 HTML 檔案，包含 Canvas 元素和控制按鈕的區域，以及基礎的 CSS 樣式。
*   **Canvas 設置**: 在 JavaScript 中獲取 Canvas 元素及其 2D 繪圖上下文 (Context)。

## 近期變更

*   將 3D 渲染邏輯重構到 `js/CubeRenderer.js`。
*   建立了 `js/CubeState.js` 模組，包含狀態表示、完整的 12 種基本旋轉邏輯、改進的隨機序列生成，以及 `toSolverString` 方法。
*   更新了 `CubeRenderer.js` 的 `updateColors` 方法。
*   ~~建立了**模擬**的解題函式庫 `js/lib/solver.js`。~~ (已移除)
*   **嘗試整合外部解題器 `cubejs`**:
    *   嘗試透過 CDN 載入，遇到 404 錯誤。
    *   嘗試下載到本地 `js/lib/` 並載入，但決定改變策略。
*   **決定採用反轉打亂序列作為簡易 "解題" 方法**:
    *   修改了 `js/SimpleSolver.js`，使其接收打亂序列並回傳反轉、反向的版本。
*   更新了 `main.js`：
    *   移除 `cubejs` 相關邏輯 (初始化等待)。
    *   導入並使用 `js/SimpleSolver.js`。
    *   儲存最後一次生成的打亂序列 (`lastScrambleSequence`)。
    *   「隨機產生」按鈕功能不變 (但會儲存序列)。
    *   「自動解題」按鈕現在將儲存的打亂序列傳遞給 `SimpleSolver.js`。
*   更新了 `index.html`：
    *   移除了載入外部/本地 `cubejs` 的 `<script>` 標籤。
*   刪除了 `js/lib` 目錄。

## 下一步計畫

1.  **動畫引擎**: 設計和實作單步旋轉動畫。這是目前的主要任務。
2.  **解題動畫播放**: 將 `SimpleSolver.js` 返回的**反轉序列**傳遞給動畫引擎進行播放。
3.  **UI/UX 優化**: 禁用按鈕、顯示當前步驟等。
4.  **(可選) 替換為真實解題器**: 未來如果需要，可以重新評估並實作或整合一個真正的解題演算法來取代目前的反轉邏輯。

## 當前決策與考量

*   **檔案結構**: 採用簡單的根目錄結構 (`index.html`, `style.css`, `main.js`)，並將 Memory Bank 放在 `memory-bank/` 子目錄中。未來可能根據複雜度增加而建立 `src/` 或 `js/` 等子目錄。
*   **渲染起點**: 從最基本的單一立方體渲染開始，逐步增加複雜度到 3x3x3 的魔術方塊。

## 重要模式與偏好

*   **原生優先**: 盡可能使用瀏覽器原生 API (HTML, CSS, JS, Canvas 2D)，避免引入大型框架或函式庫。**目前使用反轉序列的簡易 "解題" 邏輯，符合此原則**。
*   **模組化**: 儘早開始將程式碼組織成模組 (ES6 Modules)。 (持續進行中)
*   **註解與可讀性**: 保持程式碼清晰、易於理解，特別是涉及複雜 3D 計算、狀態管理和**動畫引擎**的部分。

## 學習與洞見

*   整合外部函式庫（特別是透過 CDN）可能存在版本、路徑或可用性問題。
*   自行實作核心功能（如解題器）雖然挑戰更大，但能提供更多控制權並避免外部依賴問題。（目前採用反轉序列作為權宜之計）
